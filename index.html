<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraction Master Class</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <style>
        :root {
            --c-green: #4CAF50;
            --c-green-light: #e8f5e9;
            --c-blue: #2196F3;
            --c-blue-light: #e3f2fd;
            --c-gold: #FFC107; 
            --c-gold-light: #fff8e1;
            --c-red: #ef5350; 
            --bg-body: #f0f4f8;
            --bg-card: #ffffff;
            --text-main: #37474f;
            --text-muted: #78909c;
            --border: #cfd8dc;
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-body);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 60px;
        }

        /* --- HEADER & NAV --- */
        .header {
            width: 100%; background: white; padding: 15px; text-align: center;
            border-bottom: 1px solid var(--border); box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px;
        }
        .header h1 { font-family: 'Fredoka', sans-serif; color: var(--text-main); font-size: 1.5rem; }

        .main-nav {
            display: flex; gap: 10px; margin-bottom: 25px; background: #dfe6e9; padding: 6px; border-radius: 50px;
        }
        .nav-tab {
            background: transparent; border: none; color: var(--text-muted); padding: 10px 25px;
            font-family: 'Fredoka', sans-serif; font-size: 1rem; cursor: pointer; border-radius: 40px; transition: all 0.2s; font-weight: 600;
        }
        .nav-tab.active { background: white; color: var(--c-green); box-shadow: 0 4px 10px rgba(0,0,0,0.08); }

        .tool-section {
            display: none; width: 100%; max-width: 950px; flex-direction: column; align-items: center; animation: fadeIn 0.3s ease; padding: 0 15px;
        }
        .tool-section.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- SHARED DASHBOARD STYLES --- */
        .dashboard {
            background: var(--bg-card); padding: 25px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.05);
            width: 100%; display: flex; flex-direction: column; align-items: center; gap: 20px; margin-bottom: 30px; border: 1px solid white;
        }

        /* --- FRACTION LAB SPECIFIC --- */
        .frac-group { display: flex; flex-direction: column; align-items: center; width: 90px; padding: 10px; border-radius: 12px; border: 2px solid transparent; }
        .frac-group.focus-green { background: var(--c-green-light); border-color: var(--c-green); }
        .frac-group.focus-blue { background: var(--c-blue-light); border-color: var(--c-blue); }
        .frac-input { width: 100%; font-family: 'Fredoka', sans-serif; font-size: 2.2rem; text-align: center; border: 2px solid #eceff1; border-radius: 8px; }
        .operator { font-size: 3rem; color: var(--text-muted); font-family: 'Fredoka'; margin: 0 10px; }
        .vis-card { background: white; border-radius: 16px; padding: 25px; width: 100%; border: 1px solid #eceff1; margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; }

        /* --- FRACTION BARS SPECIFIC --- */
        .fb-toolbar {
            display: flex; align-items: center; justify-content: space-between;
            flex-wrap: wrap; gap: 15px; width: 100%; background: #1f2937; color: white; padding: 12px 20px; border-radius: 12px; margin-bottom: 15px;
        }
        .fb-work-area { width: 100%; position: relative; min-height: 250px; max-height: 55vh; overflow-y: auto; padding: 15px 0; }
        .fb-bars-wrapper { display: flex; flex-direction: column; gap: 15px; width: 100%; position: relative; }
        
        #alignment-line {
            position: absolute; top: 0; bottom: 0; width: 3px; background: var(--c-red); 
            border-left: 1px dashed white; z-index: 50; display: none; pointer-events: none;
        }

        .fb-row { display: flex; align-items: center; gap: 15px; }
        .fb-row-label { width: 50px; text-align: right; font-size: 0.9rem; font-weight: 700; color: var(--text-muted); }
        .fb-value-badge {
            width: 85px; height: 35px; background: #eceff1; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 1rem;
            color: var(--text-main); border: 1px solid var(--border); transition: all 0.2s;
        }
        .fb-row.imperfect .fb-value-badge { background: #ffebee; border-color: var(--c-red); color: var(--c-red); }
        .fb-row.perfect .fb-value-badge { background: var(--c-green-light); border-color: var(--c-green); color: #2e7d32; }

        .fb-bar { flex: 1; height: 55px; display: flex; border: 2px solid #111827; border-radius: 6px; overflow: hidden; background: #eee; }
        .fb-seg { flex: 1; border-right: 1px solid rgba(0,0,0,0.15); cursor: pointer; background-color: var(--fb-base); }
        .fb-seg.fb-selected { background-color: var(--fb-highlight) !important; }

        .fb-controls-panel { width: 100%; background: white; border-radius: 12px; padding: 20px; border: 1px solid #eceff1; display: flex; flex-direction: column; gap: 15px; align-items: center; }
        .fb-preset-btn { background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; padding: 8px 16px; border-radius: 8px; font-family: 'Fredoka'; font-weight: 600; cursor: pointer; }
        .fb-custom-input { width: 90px; padding: 10px; border: 2px solid var(--c-blue); border-radius: 10px; font-family: 'Fredoka'; font-size: 1.2rem; text-align: center; }

        /* --- LCD & SIMPLIFY --- */
        .chart-container { overflow-x: auto; width: 100%; }
        .mult-chart { border-collapse: separate; border-spacing: 3px; margin: 0 auto; }
        .mult-chart td, .mult-chart th { width: 40px; height: 40px; text-align: center; font-family: 'Fredoka'; border-radius: 4px; border: 1px solid #eee; }
        .lcd-match { background: var(--c-gold); color: #3e2723; font-weight: 800; transform: scale(1.1); }

        .btn { padding: 8px 20px; border-radius: 30px; font-family: 'Fredoka'; font-weight: 600; cursor: pointer; border: none; }
        .btn-blue { background: var(--c-blue); color: white; }
        .btn-green { background: var(--c-green); color: white; }
        .btn-outline { background: white; border: 1px solid var(--border); color: var(--text-muted); }

        svg { overflow: visible; }
    </style>
</head>
<body>

    <div class="header"><h1>Fraction Master Class</h1></div>

    <div class="main-nav">
        <button class="nav-tab active" onclick="switchTab('tab-bars')">Fraction Bars</button>
        <button class="nav-tab" onclick="switchTab('tab-fractions')">Fraction Lab</button>
        <button class="nav-tab" onclick="switchTab('tab-lcd')">LCD Finder</button>
        <button class="nav-tab" onclick="switchTab('tab-simplify')">Simplify</button>
    </div>

    <div id="tab-bars" class="tool-section active">
        <div class="fb-toolbar">
            <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                <input type="checkbox" id="fb-sync-equivalents" checked style="transform:scale(1.4)">
                <span style="font-family:'Fredoka'; font-weight:600;">Sync Equivalents (Show Mismatches)</span>
            </label>
            <div class="fb-total-display" id="fb-total-display" style="font-family:monospace; font-weight:bold; background:#374151; padding:6px 12px; border-radius:8px;">Total: 0</div>
            <button class="btn" style="background:var(--c-red); color:white;" onclick="fb_reset()">Clear All</button>
        </div>

        <div class="dashboard" style="position:relative;">
            <div class="fb-work-area" id="fb-work-area">
                <div id="alignment-line"></div>
                <div class="fb-bars-wrapper" id="fb-bars-wrapper"></div>
            </div>
        </div>

        <div class="fb-controls-panel">
            <div style="background:#f8fafc; padding:20px; border-radius:12px; border:1px dashed var(--border); width:100%; display:flex; flex-direction:column; align-items:center; gap:10px;">
                <label style="font-family:'Fredoka'; font-weight:700; color:var(--c-blue); font-size:0.9rem;">CUSTOM DENOMINATOR (1-100)</label>
                <div style="display:flex; gap:15px; align-items:center;">
                    <input type="range" id="fb-slider" min="1" max="100" value="8" oninput="syncFBInput(this.value)" style="width:200px; accent-color:var(--c-blue);">
                    <input type="number" id="fb-custom-input" class="fb-custom-input" value="8" oninput="syncFBSlider(this.value)" onkeydown="if(event.key==='Enter') fb_addCustom()">
                    <button class="btn btn-blue" onclick="fb_addCustom()">Add 1/<span id="fb-preview-val">8</span> Bar</button>
                </div>
            </div>
            <div style="display:flex; flex-wrap:wrap; gap:8px; justify-content:center; align-items:center; margin-top:10px;">
                <span style="font-size:0.8rem; font-weight:800; color:var(--text-muted); margin-right:5px;">RULER PRESETS:</span>
                <button class="fb-preset-btn" onclick="fb_addBar(1)">1/1</button>
                <button class="fb-preset-btn" onclick="fb_addBar(2)">1/2</button>
                <button class="fb-preset-btn" onclick="fb_addBar(4)">1/4</button>
                <button class="fb-preset-btn" onclick="fb_addBar(8)">1/8</button>
                <button class="fb-preset-btn" onclick="fb_addBar(16)">1/16</button>
                <button class="fb-preset-btn" onclick="fb_addBar(32)">1/32</button>
                <button class="fb-preset-btn" onclick="fb_addBar(48)">1/48</button>
            </div>
        </div>
    </div>

    <div id="tab-fractions" class="tool-section">
        <div class="dashboard">
            <div style="display:flex; gap:15px; align-items:center;">
                <div class="frac-group focus-green" id="grp-1">
                    <input type="number" id="n1" class="frac-input" value="1" oninput="updateLab()">
                    <div style="width:100%; height:4px; background:black; margin:8px 0;"></div>
                    <input type="number" id="d1" class="frac-input" value="4" oninput="handleLabDenom(1, this.value)">
                </div>
                <div class="operator">+</div>
                <div class="frac-group" id="grp-2">
                    <input type="number" id="n2" class="frac-input" value="1" oninput="updateLab()">
                    <div style="width:100%; height:4px; background:black; margin:8px 0;"></div>
                    <input type="number" id="d2" class="frac-input" value="4" oninput="handleLabDenom(2, this.value)" disabled>
                </div>
                <div class="operator">=</div>
                <div style="display:flex; flex-direction:column; align-items:center;">
                    <span id="rn" style="font-size:2.5rem; font-weight:bold;">2</span>
                    <div style="width:60px; height:4px; background:black; margin:5px 0;"></div>
                    <span id="rd" style="font-size:2.5rem; font-weight:bold;">4</span>
                </div>
            </div>
            <button class="btn btn-outline" id="lab-sync-toggle" onclick="toggleLabUnlike()">Allow Different Denominators</button>
        </div>
        <div class="vis-card">
            <div id="vis-bars-lab" style="width:100%; display:flex; flex-direction:column; gap:15px;"></div>
        </div>
        <div class="vis-card">
            <div id="vis-pies-lab" style="display:flex; gap:20px; flex-wrap:wrap; justify-content:center;"></div>
        </div>
    </div>

    <div id="tab-lcd" class="tool-section">
        <div class="dashboard"><p style="font-family:'Fredoka'; font-weight:600;">Click two column headers to find their common multiples.</p></div>
        <div class="chart-container"><table class="mult-chart" id="lcd-table"></table></div>
    </div>

    <div id="tab-simplify" class="tool-section">
        <div class="dashboard">
            <div style="display:flex; align-items:center; gap:20px;">
                <div class="frac-group"><input type="number" id="simp-n" class="frac-input" value="6" oninput="simp_update()"><div style="width:100%; height:4px; background:black; margin:8px 0;"></div><input type="number" id="simp-d" class="frac-input" value="8" oninput="simp_update()"></div>
                <div class="operator">→</div>
                <div style="display:flex; flex-direction:column; align-items:center;"><span id="simp-rn" style="font-size:2.5rem; font-weight:bold; color:var(--c-green);">3</span><div style="width:60px; height:4px; background:var(--c-green); margin:5px 0;"></div><span id="simp-rd" style="font-size:2.5rem; font-weight:bold; color:var(--c-green);">4</span></div>
            </div>
        </div>
    </div>

<script>
    // NAVIGATION
    function switchTab(tabId) {
        document.querySelectorAll('.tool-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        const map = {'tab-bars':0, 'tab-fractions':1, 'tab-lcd':2, 'tab-simplify':3};
        document.querySelectorAll('.nav-tab')[map[tabId]].classList.add('active');
    }

    // --- FRACTION BARS LOGIC ---
    let fb_bars = [];
    const syncCheckbox = document.getElementById('fb-sync-equivalents');
    const alignmentLine = document.getElementById('alignment-line');

    function syncFBInput(v) { document.getElementById('fb-custom-input').value = v; document.getElementById('fb-preview-val').innerText = v; }
    function syncFBSlider(v) { document.getElementById('fb-slider').value = v; document.getElementById('fb-preview-val').innerText = v; }

    function fb_addBar(denom) {
        const id = Date.now() + Math.random();
        const hue = (denom * 137.5) % 360;
        fb_bars.push({ id, denom, base: `hsl(${hue}, 60%, 65%)`, hl: `hsl(${hue}, 80%, 85%)` });
        fb_render();
    }

    function fb_addCustom() { fb_addBar(parseInt(document.getElementById('fb-custom-input').value)); }

    function fb_render() {
        const wrapper = document.getElementById('fb-bars-wrapper');
        wrapper.innerHTML = '';
        fb_bars.sort((a,b) => a.denom - b.denom).forEach(bar => {
            const row = document.createElement('div');
            row.className = 'fb-row';
            row.dataset.id = bar.id;
            row.dataset.denom = bar.denom;
            row.innerHTML = `<div class="fb-row-label">1/${bar.denom}</div><div class="fb-value-badge" id="val-${bar.id}">0/${bar.denom}</div>`;
            const barEl = document.createElement('div');
            barEl.className = 'fb-bar';
            for(let i=0; i<bar.denom; i++) {
                const seg = document.createElement('div');
                seg.className = 'fb-seg';
                seg.style.backgroundColor = bar.base;
                seg.style.setProperty('--fb-highlight', bar.hl);
                seg.onclick = () => handleFBClick(bar.id, i);
                barEl.appendChild(seg);
            }
            row.appendChild(barEl);
            wrapper.appendChild(row);
        });
    }

    function handleFBClick(barId, index) {
        const barObj = fb_bars.find(b => b.id === barId);
        const row = document.querySelector(`.fb-row[data-id="${barId}"]`);
        const segs = row.querySelectorAll('.fb-seg');
        const isSelected = segs[index].classList.contains('fb-selected');
        const ratio = isSelected ? (index / barObj.denom) : ((index + 1) / barObj.denom);

        if (ratio > 0 && ratio < 1) {
            alignmentLine.style.display = 'block';
            alignmentLine.style.left = `calc(150px + ${ratio} * (100% - 150px))`;
        } else { alignmentLine.style.display = 'none'; }

        fb_bars.forEach(b => {
            const bRow = document.querySelector(`.fb-row[data-id="${b.id}"]`);
            const bSegs = bRow.querySelectorAll('.fb-seg');
            const exact = ratio * b.denom;
            const count = Math.round(exact);
            const perfect = Math.abs(exact - count) < 0.001;

            if (syncCheckbox.checked) {
                bSegs.forEach((s, idx) => { if(idx < count) s.classList.add('fb-selected'); else s.classList.remove('fb-selected'); });
                updateBadge(b.id, count, b.denom, perfect);
            } else if (b.id === barId) {
                bSegs.forEach((s, idx) => { if(isSelected) { if(idx >= index) s.classList.remove('fb-selected'); } else { if(idx <= index) s.classList.add('fb-selected'); }});
                const newCount = bRow.querySelectorAll('.fb-seg.fb-selected').length;
                updateBadge(b.id, newCount, b.denom, true);
            }
        });
        fb_calcTotal();
    }

    function updateBadge(id, count, denom, perfect) {
        const b = document.getElementById(`val-${id}`);
        const r = document.querySelector(`.fb-row[data-id="${id}"]`);
        b.innerText = (perfect ? "" : "≈ ") + `${count}/${denom}`;
        r.classList.remove('perfect', 'imperfect');
        if(count > 0) r.classList.add(perfect ? 'perfect' : 'imperfect');
    }

    function fb_calcTotal() {
        let t = 0;
        document.querySelectorAll('.fb-row').forEach(r => {
            const d = parseInt(r.dataset.denom);
            const s = r.querySelectorAll('.fb-seg.fb-selected').length;
            t += (s / d);
        });
        document.getElementById('fb-total-display').innerText = `Total: ${t.toFixed(2)}`;
    }

    function fb_reset() { fb_bars = []; alignmentLine.style.display='none'; fb_render(); fb_calcTotal(); }

    // --- FRACTION LAB LOGIC ---
    let labUnlike = false;
    function toggleLabUnlike() {
        labUnlike = !labUnlike;
        document.getElementById('d2').disabled = !labUnlike;
        document.getElementById('lab-sync-toggle').innerText = labUnlike ? "Sync Denominators" : "Allow Different Denominators";
        if(!labUnlike) { document.getElementById('d2').value = document.getElementById('d1').value; }
        updateLab();
    }
    function handleLabDenom(id, v) { if(id===1 && !labUnlike) document.getElementById('d2').value = v; updateLab(); }
    
    function updateLab() {
        const n1 = parseInt(document.getElementById('n1').value) || 0;
        const d1 = parseInt(document.getElementById('d1').value) || 1;
        const n2 = parseInt(document.getElementById('n2').value) || 0;
        const d2 = parseInt(document.getElementById('d2').value) || 1;
        const common = lcm(d1, d2);
        const resN = (n1 * (common/d1)) + (n2 * (common/d2));
        document.getElementById('rn').innerText = resN;
        document.getElementById('rd').innerText = common;
        renderLabVis(n1, d1, n2, d2);
    }

    function renderLabVis(n1, d1, n2, d2) {
        const barContainer = document.getElementById('vis-bars-lab');
        const pieContainer = document.getElementById('vis-pies-lab');
        barContainer.innerHTML = ''; pieContainer.innerHTML = '';

        const drawBar = (n, d, col) => {
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "100%"); svg.setAttribute("height", "40");
            for(let i=0; i<d; i++){
                const r = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                r.setAttribute("x", (i*(100/d))+"%"); r.setAttribute("width", (100/d)+"%"); r.setAttribute("height", "30");
                r.setAttribute("stroke", "#333"); r.setAttribute("fill", i < n ? col : "white");
                svg.appendChild(r);
            }
            barContainer.appendChild(svg);
        };
        drawBar(n1, d1, "var(--c-green)"); drawBar(n2, d2, "var(--c-blue)");

        const drawPie = (n, d, col) => {
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "100"); svg.setAttribute("height", "100"); svg.setAttribute("viewBox", "0 0 100 100");
            for(let i=0; i<d; i++) {
                const start = (i * 360 / d) - 90; const end = ((i+1) * 360 / d) - 90;
                const x1 = 50 + 40 * Math.cos(Math.PI * start / 180); const y1 = 50 + 40 * Math.sin(Math.PI * start / 180);
                const x2 = 50 + 40 * Math.cos(Math.PI * end / 180); const y2 = 50 + 40 * Math.sin(Math.PI * end / 180);
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", `M 50 50 L ${x1} ${y1} A 40 40 0 0 1 ${x2} ${y2} Z`);
                path.setAttribute("fill", i < n ? col : "white"); path.setAttribute("stroke", "#333");
                svg.appendChild(path);
            }
            pieContainer.appendChild(svg);
        };
        drawPie(n1, d1, "var(--c-green)"); drawPie(n2, d2, "var(--c-blue)");
    }

    // --- LCD FINDER LOGIC ---
    function initLCD() {
        const table = document.getElementById('lcd-table');
        let h = '<tr><th>×</th>';
        for(let i=1; i<=12; i++) h += `<th onclick="lcd_toggle(${i})" style="cursor:pointer; background:#eee;">${i}</th>`;
        h += '</tr>';
        for(let r=1; r<=12; r++) {
            h += `<tr><td style="font-weight:bold; background:#eee;">${r}</td>`;
            for(let c=1; c<=12; c++) h += `<td id="lcd-${r}-${c}">${r*c}</td>`;
            h += '</tr>';
        }
        table.innerHTML = h;
    }
    let selectedLCD = [];
    function lcd_toggle(n) {
        if(selectedLCD.includes(n)) selectedLCD = selectedLCD.filter(x => x!==n);
        else { selectedLCD.push(n); if(selectedLCD.length > 2) selectedLCD.shift(); }
        document.querySelectorAll('.mult-chart td').forEach(e => e.classList.remove('lcd-match'));
        if(selectedLCD.length === 2) {
            const target = lcm(selectedLCD[0], selectedLCD[1]);
            document.querySelectorAll('.mult-chart td').forEach(e => { if(parseInt(e.innerText) === target) e.classList.add('lcd-match'); });
        }
    }

    // --- SIMPLIFY LOGIC ---
    function simp_update() {
        const n = parseInt(document.getElementById('simp-n').value) || 0;
        const d = parseInt(document.getElementById('simp-d').value) || 1;
        const common = gcd(n, d);
        document.getElementById('simp-rn').innerText = n / common;
        document.getElementById('simp-rd').innerText = d / common;
    }

    // HELPERS
    const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
    const lcm = (a, b) => (a * b) / gcd(a, b);

    window.onload = () => { initLCD(); updateLab(); simp_update(); fb_addBar(1); fb_addBar(2); fb_addBar(8); };
</script>
</body>
</html>
