<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraction Master Class</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <style>
        :root {
            --bg-dark: #1a1a2e;
            --bg-panel: #16213e;
            --bg-input: #0f3460;
            --accent-pink: #e94560;
            --accent-cyan: #53d8fb;
            --accent-green: #06d6a0;
            --accent-yellow: #f9c74f;
            --text-main: #eee;
            --text-muted: rgba(255,255,255,0.6);
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-dark);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- HEADER & NAV --- */
        .header {
            width: 100%;
            background: linear-gradient(135deg, var(--bg-panel), #0f3460);
            padding: 15px 20px;
            text-align: center;
            border-bottom: 3px solid var(--accent-pink);
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            margin-bottom: 20px;
        }
        .header h1 {
            font-family: 'Fredoka', sans-serif;
            color: #fff;
            letter-spacing: 1px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: rgba(255,255,255,0.05);
            padding: 5px;
            border-radius: 50px;
        }
        .nav-tab {
            background: transparent;
            border: none;
            color: var(--text-muted);
            padding: 10px 25px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1.1rem;
            cursor: pointer;
            border-radius: 40px;
            transition: all 0.3s;
        }
        .nav-tab.active {
            background: var(--accent-pink);
            color: white;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
        }
        .nav-tab:hover:not(.active) { color: white; }

        /* --- SHARED LAYOUT --- */
        .tool-section {
            display: none; /* Hidden by default */
            width: 100%;
            max-width: 900px;
            flex-direction: column;
            align-items: center;
            padding: 0 20px 40px;
            animation: fadeIn 0.4s ease;
        }
        .tool-section.active { display: flex; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .dashboard {
            background: var(--bg-panel);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        h2 { font-family: 'Fredoka', sans-serif; color: var(--accent-cyan); margin-bottom: 10px; }
        p.subtitle { color: var(--text-muted); margin-bottom: 20px; text-align: center; max-width: 600px; }

        /* --- SHARED INPUT STYLES --- */
        .equation-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .frac-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            position: relative;
        }
        .frac-input {
            width: 100%;
            font-family: 'Fredoka', sans-serif;
            font-size: 2rem;
            text-align: center;
            background: var(--bg-input);
            border: 2px solid rgba(255,255,255,0.1);
            color: white;
            border-radius: 8px;
            padding: 5px 0;
            transition: all 0.2s;
        }
        .frac-input:focus { outline: none; border-color: var(--accent-cyan); box-shadow: 0 0 15px rgba(83, 216, 251, 0.2); }
        
        .frac-bar { width: 100%; height: 3px; background: rgba(255,255,255,0.3); margin: 6px 0; border-radius: 2px; }
        .operator { font-size: 2.5rem; color: var(--text-muted); font-family: 'Fredoka', sans-serif; }

        /* Color Coding */
        .color-a { color: var(--accent-cyan); }
        .color-b { color: var(--accent-pink); }
        .color-res { color: var(--accent-green); }
        
        .border-a:focus { border-color: var(--accent-cyan) !important; }
        .border-b:focus { border-color: var(--accent-pink) !important; }

        /* --- VISUALIZATION CONTAINERS --- */
        .vis-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .vis-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .vis-label {
            font-family: 'Fredoka', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 15px;
        }

        /* --- SVG STYLES --- */
        svg { overflow: visible; }
        .svg-text { font-family: 'Fredoka', sans-serif; fill: var(--text-muted); font-size: 14px; }
        .svg-text-bold { font-family: 'Fredoka', sans-serif; fill: white; font-weight: bold; font-size: 24px; }

        /* Bars/Pies Shared */
        .shape-stroke { stroke: rgba(255,255,255,0.2); stroke-width: 2px; }
        .fill-empty { fill: rgba(255,255,255,0.05); }
        .fill-a { fill: var(--accent-cyan); opacity: 0.8; transition: opacity 0.2s; }
        .fill-b { fill: var(--accent-pink); opacity: 0.8; transition: opacity 0.2s; }
        .fill-res { fill: var(--accent-green); opacity: 0.9; }
        .fill-a:hover, .fill-b:hover { opacity: 1; cursor: pointer; }

        /* --- TAB 3: LCD SPECIFIC --- */
        .chart-container { overflow-x: auto; max-width: 100%; padding-bottom: 10px; }
        .mult-chart { border-collapse: collapse; margin: 0 auto; }
        .mult-chart td, .mult-chart th {
            width: 40px; height: 40px; text-align: center;
            font-family: 'Fredoka', sans-serif; font-size: 14px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s;
        }
        .col-header { background: var(--bg-panel); color: var(--text-muted); cursor: pointer; }
        .col-header:hover { background: #1a3a6e; color: white; }
        .col-header.sel-a { background: var(--accent-cyan); color: var(--bg-dark); box-shadow: 0 0 10px var(--accent-cyan); }
        .col-header.sel-b { background: var(--accent-pink); color: var(--bg-dark); box-shadow: 0 0 10px var(--accent-pink); }
        
        .data-cell { color: rgba(255,255,255,0.2); }
        .data-cell.hl-a { background: rgba(83, 216, 251, 0.15); color: var(--accent-cyan); }
        .data-cell.hl-b { background: rgba(233, 69, 96, 0.15); color: var(--accent-pink); }
        .data-cell.lcd-match { 
            background: var(--accent-green); color: var(--bg-dark); font-weight: bold;
            box-shadow: 0 0 20px var(--accent-green); transform: scale(1.1); z-index: 5;
            border-radius: 4px;
        }

        /* --- TAB 2 SPECIFIC --- */
        .toggle-btn {
            background: var(--bg-input);
            border: 2px solid var(--accent-yellow);
            color: var(--accent-yellow);
            padding: 8px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-family: 'Fredoka', sans-serif;
            font-weight: bold;
            transition: all 0.2s;
            margin-top: 15px;
        }
        .toggle-btn:hover { background: rgba(249, 199, 79, 0.1); }
        .toggle-btn.active { background: var(--accent-yellow); color: var(--bg-dark); }

        .ghost-label {
            position: absolute; top: -30px;
            background: var(--accent-yellow); color: var(--bg-dark);
            padding: 2px 8px; border-radius: 4px; font-weight: bold; font-size: 0.9rem;
            opacity: 0; transform: translateY(10px); transition: all 0.3s; pointer-events: none;
        }
        .show-common .ghost-label { opacity: 1; transform: translateY(0); }
        
        .grid-line { stroke: rgba(255,255,255,0.2); stroke-width: 2px; }
        .sub-line { stroke: var(--accent-yellow); stroke-width: 1px; stroke-dasharray: 4 2; opacity: 0; transition: opacity 0.5s; }
        .show-common .sub-line { opacity: 0.8; }

    </style>
</head>
<body>

    <div class="header">
        <h1>Fraction Master Class</h1>
    </div>

    <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('tab-like')">Visual Painter</button>
        <button class="nav-tab" onclick="switchTab('tab-unlike')">Unlike Grids</button>
        <button class="nav-tab" onclick="switchTab('tab-lcd')">LCD Finder</button>
    </div>

    <div id="tab-like" class="tool-section active">
        <h2>Like Fractions</h2>
        <p class="subtitle">Type numbers or paint the shapes directly. Notice how the denominator never changes.</p>

        <div class="dashboard">
            <div style="display:flex; gap:10px;">
                <button class="toggle-btn" id="btn-paint-a" onclick="setPaintMode('a')" style="border-color:var(--accent-cyan); color:var(--accent-cyan)">Paint Cyan</button>
                <button class="toggle-btn" id="btn-paint-b" onclick="setPaintMode('b')" style="border-color:var(--accent-pink); color:var(--accent-pink)">Paint Pink</button>
            </div>

            <div class="equation-wrapper">
                <div class="frac-group">
                    <input type="number" id="l-n1" class="frac-input color-a border-a" value="1" min="0" oninput="like_update()">
                    <div class="frac-bar"></div>
                    <input type="number" id="l-d1" class="frac-input" value="5" min="1" max="12" oninput="like_denomChange(this.value)">
                </div>
                <div class="operator">+</div>
                <div class="frac-group">
                    <input type="number" id="l-n2" class="frac-input color-b border-b" value="2" min="0" oninput="like_update()">
                    <div class="frac-bar"></div>
                    <input type="number" id="l-d2" class="frac-input" value="5" disabled style="opacity:0.7">
                </div>
                <div class="operator">=</div>
                <div class="frac-group">
                    <span id="l-rn" class="frac-input" style="border:none; background:transparent; font-size:2.5rem; color:var(--accent-green)">3</span>
                    <div class="frac-bar" style="background:var(--accent-green)"></div>
                    <span id="l-rd" class="frac-input" style="border:none; background:transparent; font-size:2.5rem; color:var(--accent-green)">5</span>
                </div>
            </div>
        </div>

        <div class="vis-container">
            <div class="vis-card">
                <div class="vis-label">Bar Model</div>
                <div id="like-bars" style="width:100%; display:flex; flex-direction:column; gap:10px; align-items:center;"></div>
            </div>
            <div class="vis-card">
                <div class="vis-label">Circle Model</div>
                <div id="like-pies" style="display:flex; flex-wrap:wrap; gap:20px; justify-content:center;"></div>
            </div>
            <div class="vis-card">
                <div class="vis-label">Number Line</div>
                <div id="like-line" style="width:100%; overflow-x:auto;"></div>
            </div>
        </div>
    </div>

    <div id="tab-unlike" class="tool-section">
        <h2>Unlike Fractions</h2>
        <p class="subtitle">Different sizes don't fit. Turn on the "Common Grid" to make them match.</p>

        <div class="dashboard">
            <div class="equation-wrapper" id="unlike-eq-wrapper">
                <div class="frac-group">
                    <div class="ghost-label" id="u-ghost-1">3/6</div>
                    <input type="number" id="u-n1" class="frac-input color-a border-a" value="1" min="0" oninput="unlike_update()">
                    <div class="frac-bar"></div>
                    <input type="number" id="u-d1" class="frac-input color-a border-a" value="2" min="1" max="12" oninput="unlike_update()">
                </div>
                <div class="operator">+</div>
                <div class="frac-group">
                    <div class="ghost-label" id="u-ghost-2">2/6</div>
                    <input type="number" id="u-n2" class="frac-input color-b border-b" value="1" min="0" oninput="unlike_update()">
                    <div class="frac-bar"></div>
                    <input type="number" id="u-d2" class="frac-input color-b border-b" value="3" min="1" max="12" oninput="unlike_update()">
                </div>
                <div class="operator">=</div>
                <div class="frac-group">
                    <div id="u-res-final" style="display:none; text-align:center;">
                        <span id="u-rn" style="font-size:2.5rem; font-weight:bold; color:var(--accent-green)">5</span>
                        <div class="frac-bar" style="background:var(--accent-green)"></div>
                        <span id="u-rd" style="font-size:2.5rem; font-weight:bold; color:var(--accent-green)">6</span>
                    </div>
                    <div id="u-res-unknown" style="font-size:3rem; color:rgba(255,255,255,0.2); font-family:'Fredoka',sans-serif">?</div>
                </div>
            </div>

            <button class="toggle-btn" id="btn-common" onclick="unlike_toggleCommon()">
                Show Common Grid
            </button>
        </div>

        <div class="vis-container" id="unlike-vis-root">
            <div class="vis-card">
                <div class="vis-label">First Fraction (Cyan)</div>
                <div id="u-svg-1" style="width:100%"></div>
            </div>
            <div class="vis-card">
                <div class="vis-label">Second Fraction (Pink)</div>
                <div id="u-svg-2" style="width:100%"></div>
            </div>
            <div class="vis-card">
                <div class="vis-label">Combined Result</div>
                <div id="u-svg-3" style="width:100%"></div>
            </div>
        </div>
    </div>

    <div id="tab-lcd" class="tool-section">
        <h2>LCD Finder</h2>
        <p class="subtitle">Find the smallest number that appears in both multiplication columns.</p>

        <div class="dashboard">
            <p id="lcd-instruction" style="font-size:1.2rem; font-family:'Fredoka',sans-serif; min-height:30px;">
                Pick two denominators in the top row to start.
            </p>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="toggle-btn" onclick="lcd_reset()">Reset</button>
                <button class="toggle-btn" id="lcd-btn-anim" onclick="lcd_animate()" disabled style="border-color:var(--accent-green); color:var(--accent-green)">Show Match</button>
            </div>
        </div>

        <div class="chart-container">
            <table class="mult-chart" id="lcd-table"></table>
        </div>
    </div>

<script>
    // --- GLOBAL TAB LOGIC ---
    function switchTab(tabId) {
        document.querySelectorAll('.tool-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
        
        document.getElementById(tabId).classList.add('active');
        // Highlight correct button
        const index = ['tab-like','tab-unlike','tab-lcd'].indexOf(tabId);
        document.querySelectorAll('.nav-tab')[index].classList.add('active');
    }

    // ==========================================
    // LOGIC: LIKE FRACTIONS
    // ==========================================
    let l_n1 = 1, l_n2 = 2, l_den = 5;
    let l_paintMode = 'a'; // 'a' or 'b'

    function setPaintMode(mode) {
        l_paintMode = mode;
        const btnA = document.getElementById('btn-paint-a');
        const btnB = document.getElementById('btn-paint-b');
        if(mode === 'a') {
            btnA.style.background = 'var(--accent-cyan)'; btnA.style.color = '#1a1a2e';
            btnB.style.background = 'transparent'; btnB.style.color = 'var(--accent-pink)';
        } else {
            btnA.style.background = 'transparent'; btnA.style.color = 'var(--accent-cyan)';
            btnB.style.background = 'var(--accent-pink)'; btnB.style.color = '#1a1a2e';
        }
    }

    function like_denomChange(val) {
        let v = parseInt(val) || 1;
        if(v > 12) v = 12; if(v < 1) v = 1;
        l_den = v;
        document.getElementById('l-d1').value = v;
        document.getElementById('l-d2').value = v;
        like_update();
    }

    function like_update() {
        // Read inputs just in case typed
        l_n1 = parseInt(document.getElementById('l-n1').value) || 0;
        l_n2 = parseInt(document.getElementById('l-n2').value) || 0;
        
        // Update Result
        const total = l_n1 + l_n2;
        document.getElementById('l-rn').innerText = total;
        document.getElementById('l-rd').innerText = l_den;

        const wholes = Math.max(1, Math.ceil(total / l_den));
        if(total % l_den === 0 && total > 0) {} // keeping strict logic simple
        
        like_renderBars(wholes);
        like_renderPies(wholes);
        like_renderLine(wholes);
    }

    function like_clickPiece(type) {
        if(type === 'a' && l_n1 > 0) l_n1--;
        else if(type === 'b' && l_n2 > 0) l_n2--;
        else if(type === 'empty') {
            if(l_paintMode === 'a') l_n1++;
            else l_n2++;
        }
        document.getElementById('l-n1').value = l_n1;
        document.getElementById('l-n2').value = l_n2;
        like_update();
    }

    function like_renderBars(wholes) {
        const container = document.getElementById('like-bars');
        container.innerHTML = '';
        let c1 = l_n1, c2 = l_n2;

        for(let w=0; w<wholes; w++){
            const row = document.createElement('div');
            row.style.display = 'flex';
            row.style.width = '100%';
            row.style.maxWidth = '600px';
            row.style.height = '50px';
            row.style.border = '2px solid rgba(255,255,255,0.2)';
            row.style.borderRadius = '8px';
            row.style.overflow = 'hidden';
            row.style.cursor = 'pointer';

            for(let i=0; i<l_den; i++){
                const cell = document.createElement('div');
                cell.style.flex = 1;
                cell.style.borderRight = '1px solid rgba(255,255,255,0.1)';
                cell.style.transition = 'background 0.2s';
                
                if(c1 > 0) { cell.style.background = 'var(--accent-cyan)'; cell.onclick = () => like_clickPiece('a'); c1--; }
                else if(c2 > 0) { cell.style.background = 'var(--accent-pink)'; cell.onclick = () => like_clickPiece('b'); c2--; }
                else { cell.style.background = 'transparent'; cell.onclick = () => like_clickPiece('empty'); }
                
                row.appendChild(cell);
            }
            container.appendChild(row);
        }
    }

    function like_renderPies(wholes) {
        const container = document.getElementById('like-pies');
        container.innerHTML = '';
        let c1 = l_n1, c2 = l_n2;

        for(let w=0; w<wholes; w++){
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("width", "120"); svg.setAttribute("height", "120");
            svg.setAttribute("viewBox", "-5 -5 110 110");
            
            const cx = 50, cy = 50, r = 50;

            for(let i=0; i<l_den; i++){
                let cls = 'fill-empty', type = 'empty';
                if(c1 > 0) { cls = 'fill-a'; type = 'a'; c1--; }
                else if(c2 > 0) { cls = 'fill-b'; type = 'b'; c2--; }

                const startAngle = (i*360/l_den) - 90;
                const endAngle = ((i+1)*360/l_den) - 90;
                const x1 = cx + r * Math.cos(startAngle*Math.PI/180);
                const y1 = cy + r * Math.sin(startAngle*Math.PI/180);
                const x2 = cx + r * Math.cos(endAngle*Math.PI/180);
                const y2 = cy + r * Math.sin(endAngle*Math.PI/180);
                const large = (endAngle - startAngle) > 180 ? 1 : 0;
                
                const path = document.createElementNS(svgNS, "path");
                path.setAttribute("d", `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${large} 1 ${x2} ${y2} Z`);
                path.setAttribute("class", `shape-stroke ${cls}`);
                path.onclick = () => like_clickPiece(type);
                svg.appendChild(path);
            }
            container.appendChild(svg);
        }
    }

    function like_renderLine(wholes) {
        const container = document.getElementById('like-line');
        container.innerHTML = '';
        const w = Math.max(600, wholes * 300);
        const svgNS = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute("width", w); svg.setAttribute("height", "100");
        
        const margin = 30;
        const lineY = 60;
        const effW = w - 2*margin;
        const step = effW / (wholes * l_den);

        // Main line
        const line = document.createElementNS(svgNS, "line");
        line.setAttribute("x1", margin); line.setAttribute("y1", lineY);
        line.setAttribute("x2", w-margin); line.setAttribute("y2", lineY);
        line.setAttribute("stroke", "rgba(255,255,255,0.5)"); line.setAttribute("stroke-width", 2);
        svg.appendChild(line);

        for(let i=0; i<=wholes*l_den; i++){
            const x = margin + i*step;
            const isWhole = i % l_den === 0;
            const tick = document.createElementNS(svgNS, "line");
            tick.setAttribute("x1", x); tick.setAttribute("x2", x);
            tick.setAttribute("y1", lineY); tick.setAttribute("y2", lineY + (isWhole ? 15:8));
            tick.setAttribute("stroke", "rgba(255,255,255,0.5)");
            svg.appendChild(tick);

            if(isWhole) {
                const txt = document.createElementNS(svgNS, "text");
                txt.setAttribute("x", x); txt.setAttribute("y", lineY + 35);
                txt.setAttribute("text-anchor", "middle");
                txt.textContent = i/l_den;
                txt.setAttribute("class", "svg-text-bold");
                svg.appendChild(txt);
            }
        }
        
        // Jumps
        if(l_n1 > 0) {
            const x1 = margin; const x2 = margin + l_n1*step;
            svg.appendChild(createJump(svgNS, x1, x2, lineY, 'var(--accent-cyan)'));
        }
        if(l_n2 > 0) {
            const start = margin + l_n1*step;
            const end = start + l_n2*step;
            svg.appendChild(createJump(svgNS, start, end, lineY, 'var(--accent-pink)'));
        }
        
        container.appendChild(svg);
    }
    
    function createJump(ns, x1, x2, y, color) {
        const path = document.createElementNS(ns, "path");
        const mid = (x1+x2)/2;
        const h = Math.min(50, 20 + (x2-x1)/10);
        path.setAttribute("d", `M ${x1} ${y-5} Q ${mid} ${y-5-h} ${x2} ${y-5}`);
        path.setAttribute("fill", "none");
        path.setAttribute("stroke", color);
        path.setAttribute("stroke-width", 4);
        return path;
    }

    // ==========================================
    // LOGIC: UNLIKE FRACTIONS
    // ==========================================
    let u_common = false;
    const gcd = (a, b) => b == 0 ? a : gcd(b, a % b);
    const lcm = (a, b) => (a * b) / gcd(a, b);

    function unlike_toggleCommon() {
        u_common = !u_common;
        const btn = document.getElementById('btn-common');
        const root = document.getElementById('tab-unlike');
        
        if(u_common) {
            btn.classList.add('active');
            btn.innerText = "Hide Common Grid";
            root.classList.add('show-common');
        } else {
            btn.classList.remove('active');
            btn.innerText = "Show Common Grid";
            root.classList.remove('show-common');
        }
        unlike_render();
    }

    function unlike_update() {
        unlike_render();
    }

    function unlike_render() {
        const n1 = parseInt(document.getElementById('u-n1').value)||0;
        const d1 = parseInt(document.getElementById('u-d1').value)||1;
        const n2 = parseInt(document.getElementById('u-n2').value)||0;
        const d2 = parseInt(document.getElementById('u-d2').value)||1;
        
        const cd = lcm(d1, d2);
        
        // Update Ghost Labels
        const newN1 = n1 * (cd/d1);
        const newN2 = n2 * (cd/d2);
        document.getElementById('u-ghost-1').innerText = `${newN1}/${cd}`;
        document.getElementById('u-ghost-2').innerText = `${newN2}/${cd}`;
        
        // Update Result Text
        const resDiv = document.getElementById('u-res-final');
        const unkDiv = document.getElementById('u-res-unknown');
        
        if(u_common) {
            resDiv.style.display = 'block';
            unkDiv.style.display = 'none';
            document.getElementById('u-rn').innerText = newN1 + newN2;
            document.getElementById('u-rd').innerText = cd;
        } else {
            resDiv.style.display = 'none';
            unkDiv.style.display = 'block';
        }

        // Render SVGs
        unlike_drawBar('u-svg-1', n1, d1, cd, 'fill-a');
        unlike_drawBar('u-svg-2', n2, d2, cd, 'fill-b');
        unlike_drawResult('u-svg-3', n1, d1, n2, d2, cd);
    }

    function unlike_drawBar(id, n, d, cd, colorCls) {
        const div = document.getElementById(id);
        div.innerHTML = '';
        const w = 600; const h = 60;
        const svgNS = "http://www.w3.org/2000/svg";
        const totalW = Math.max(w, w*(n/d)) + 10;
        
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute("width", "100%"); svg.setAttribute("viewBox", `0 0 ${totalW} ${h+20}`);
        
        // Bg
        const wholes = Math.ceil(Math.max(1, n/d));
        for(let i=0; i<wholes; i++){
            const rect = document.createElementNS(svgNS, "rect");
            rect.setAttribute("x", i*w); rect.setAttribute("y", 10);
            rect.setAttribute("width", w); rect.setAttribute("height", h);
            rect.setAttribute("stroke", "rgba(255,255,255,0.3)"); rect.setAttribute("stroke-width", 2);
            rect.setAttribute("fill", "transparent");
            svg.appendChild(rect);
        }
        
        // Fill
        const fillRect = document.createElementNS(svgNS, "rect");
        fillRect.setAttribute("x", 0); fillRect.setAttribute("y", 10);
        fillRect.setAttribute("width", (n/d)*w); fillRect.setAttribute("height", h);
        fillRect.setAttribute("class", colorCls);
        svg.appendChild(fillRect);
        
        // Original Lines
        for(let i=1; i<wholes*d; i++) {
            const x = i * (w/d);
            if(x % w !== 0) {
                const l = document.createElementNS(svgNS, "line");
                l.setAttribute("x1", x); l.setAttribute("x2", x);
                l.setAttribute("y1", 10); l.setAttribute("y2", 10+h);
                l.setAttribute("class", "grid-line");
                svg.appendChild(l);
            }
        }
        
        // Common Lines
        if(cd !== d) {
            for(let i=1; i<wholes*cd; i++) {
                const x = i * (w/cd);
                // Don't draw if overlapping original
                // i/cd = k/d => i*d = k*cd.
                if((i*d)%cd !== 0) {
                    const l = document.createElementNS(svgNS, "line");
                    l.setAttribute("x1", x); l.setAttribute("x2", x);
                    l.setAttribute("y1", 10); l.setAttribute("y2", 10+h);
                    l.setAttribute("class", "sub-line");
                    svg.appendChild(l);
                }
            }
        }
        div.appendChild(svg);
    }

    function unlike_drawResult(id, n1, d1, n2, d2, cd) {
        const div = document.getElementById(id);
        div.innerHTML = '';
        const w = 600; const h = 60;
        const val1 = n1/d1; const val2 = n2/d2; const total = val1+val2;
        const svgNS = "http://www.w3.org/2000/svg";
        const totalW = Math.max(w, w*total) + 10;
        
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute("width", "100%"); svg.setAttribute("viewBox", `0 0 ${totalW} ${h+20}`);
        
        // Bg
        const wholes = Math.ceil(Math.max(1, total));
        for(let i=0; i<wholes; i++){
            const rect = document.createElementNS(svgNS, "rect");
            rect.setAttribute("x", i*w); rect.setAttribute("y", 10);
            rect.setAttribute("width", w); rect.setAttribute("height", h);
            rect.setAttribute("stroke", "rgba(255,255,255,0.3)"); rect.setAttribute("stroke-width", 2);
            rect.setAttribute("fill", "transparent");
            svg.appendChild(rect);
        }
        
        // Fill 1
        const r1 = document.createElementNS(svgNS, "rect");
        r1.setAttribute("x", 0); r1.setAttribute("y", 10);
        r1.setAttribute("width", val1*w); r1.setAttribute("height", h);
        r1.setAttribute("class", "fill-a");
        svg.appendChild(r1);
        
        // Fill 2
        const r2 = document.createElementNS(svgNS, "rect");
        r2.setAttribute("x", val1*w); r2.setAttribute("y", 10);
        r2.setAttribute("width", val2*w); r2.setAttribute("height", h);
        r2.setAttribute("class", "fill-b");
        svg.appendChild(r2);

        // Lines Logic... drawing lines over fills.
        // For simplicity in this demo, just drawing common grid on top if active
        if(u_common) {
             for(let i=1; i<wholes*cd; i++) {
                const x = i * (w/cd);
                const l = document.createElementNS(svgNS, "line");
                l.setAttribute("x1", x); l.setAttribute("x2", x);
                l.setAttribute("y1", 10); l.setAttribute("y2", 10+h);
                l.setAttribute("class", "sub-line");
                l.style.opacity = 0.6; // force vis
                svg.appendChild(l);
             }
        } else {
             // Draw split line only
             const split = val1*w;
             const l = document.createElementNS(svgNS, "line");
             l.setAttribute("x1", split); l.setAttribute("x2", split);
             l.setAttribute("y1", 10); l.setAttribute("y2", 10+h);
             l.setAttribute("stroke", "white"); l.setAttribute("stroke-width", 2);
             svg.appendChild(l);
        }

        div.appendChild(svg);
    }

    // ==========================================
    // LOGIC: LCD FINDER
    // ==========================================
    const LCD_SIZE = 12;
    let lcd_selA = null;
    let lcd_selB = null;

    function lcd_init() {
        const table = document.getElementById('lcd-table');
        table.innerHTML = '';
        
        // Header
        const hRow = document.createElement('tr');
        hRow.innerHTML = '<th style="background:transparent; border:none; color:white;">Ã—</th>';
        for(let c=1; c<=LCD_SIZE; c++){
            const th = document.createElement('th');
            th.className = 'col-header';
            th.textContent = c;
            th.onclick = () => lcd_select(c);
            hRow.appendChild(th);
        }
        table.appendChild(hRow);

        // Body
        for(let r=1; r<=LCD_SIZE; r++){
            const row = document.createElement('tr');
            row.innerHTML = `<td style="background:var(--bg-panel); color:var(--text-muted)">${r}</td>`;
            for(let c=1; c<=LCD_SIZE; c++){
                const td = document.createElement('td');
                td.className = 'data-cell';
                td.textContent = r*c;
                td.id = `cell-${r}-${c}`;
                row.appendChild(td);
            }
            table.appendChild(row);
        }
    }

    function lcd_select(num) {
        const instr = document.getElementById('lcd-instruction');
        const btn = document.getElementById('lcd-btn-anim');

        if(lcd_selA === null) {
            lcd_selA = num;
            lcd_highlightCol(num, 'sel-a');
            instr.innerHTML = `Selected <span style="color:var(--accent-cyan); font-weight:bold">${num}</span>. Now pick a second.`;
        } else if(lcd_selB === null && num !== lcd_selA) {
            lcd_selB = num;
            lcd_highlightCol(num, 'sel-b');
            instr.innerHTML = `Selected <span style="color:var(--accent-cyan); font-weight:bold">${lcd_selA}</span> and <span style="color:var(--accent-pink); font-weight:bold">${lcd_selB}</span>. Click 'Show Match' to find the LCD.`;
            btn.disabled = false;
        } else if(num === lcd_selA || num === lcd_selB) {
            // ignore
        } else {
            lcd_reset();
            lcd_select(num);
        }
    }

    function lcd_highlightCol(col, cls) {
        // Highlight Header
        const headers = document.querySelectorAll('.col-header');
        headers[col-1].classList.add(cls);
        
        // Highlight Cells
        /* We won't highlight cells immediately in this version to save visual clutter until animation, 
           or we can highlight bg lightly. Let's do nothing for cells yet. */
    }

    function lcd_animate() {
        if(!lcd_selA || !lcd_selB) return;
        document.getElementById('lcd-btn-anim').disabled = true;
        
        const myLcm = lcm(lcd_selA, lcd_selB);
        
        // Reveal Logic
        let r = 1;
        const interval = setInterval(() => {
            if(r > LCD_SIZE) { clearInterval(interval); return; }
            
            // Highlight cells in Col A
            const cellA = document.getElementById(`cell-${r}-${lcd_selA}`);
            if(cellA) {
                cellA.classList.add('hl-a');
                if(r * lcd_selA === myLcm) cellA.classList.add('lcd-match');
            }
            
            // Highlight cells in Col B
            const cellB = document.getElementById(`cell-${r}-${lcd_selB}`);
            if(cellB) {
                cellB.classList.add('hl-b');
                if(r * lcd_selB === myLcm) cellB.classList.add('lcd-match');
            }

            // Check stopping condition for animation
            if(r * lcd_selA >= myLcm && r * lcd_selB >= myLcm) {
               document.getElementById('lcd-instruction').innerHTML = 
               `Match found! The LCD is <span style="color:var(--accent-green); font-size:1.5rem; font-weight:bold">${myLcm}</span>`;
            }

            r++;
        }, 100);
    }

    function lcd_reset() {
        lcd_selA = null; lcd_selB = null;
        document.getElementById('lcd-instruction').innerText = "Pick two denominators in the top row to start.";
        document.getElementById('lcd-btn-anim').disabled = true;
        
        // Clear classes
        document.querySelectorAll('.col-header').forEach(el => el.classList.remove('sel-a', 'sel-b'));
        document.querySelectorAll('.data-cell').forEach(el => el.classList.remove('hl-a', 'hl-b', 'lcd-match'));
    }

    // INIT
    setPaintMode('a');
    like_update();
    unlike_update();
    lcd_init();

</script>
</body>
</html>
